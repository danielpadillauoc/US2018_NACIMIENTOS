---
title: "Preproceso de Datos"
author: "Daniel Padilla Ortega"
date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r librerias, include=FALSE}
library(knitr)
library(dplyr)
library(ggplot2)
```

1.Descripción del dataset. ¿Por qué es importante y qué pregunta/problema pretende
responder?


* 1-ATTEND: Asistente en el parto (1)Doctor en Medicina, (2)Doctor en Osteopatía, (3)Comadrona, (4)Otro tipo de enfermera, (5)Other  

* 2-BFACIL: Lugar de nacimiento (1)Hospital, (2)Centro de maternidad independiente, (3)Hogar(Previsto), (4)Hogar(No Previsto), (5)Hogar(Desconocido), (6)Clinica, (7)Otro

* 3-**BMI:** Indice de Masa Corporal de la madre.
* 4-**CIG_0:** Cigarros antes del embarazo
* 5-**DBWT:** Peso al nacer en gramos
* 6-DLMP_MM: Ultimos meses de menstruación normal
* 7-DLMP_YY: Año de la última menstruación normal
* 8-**DMAR:** Estado Civil de la Madre (1)Casada, (2)Soltera
* 9-DOB_MM: Mes de nacimiento 
* 10-DOB_TT: Hora de nacimiento
* 11-DOB_WK: Día de la semana de nacimiento
* 12-DOB_YY: Año de nacimiento
* 13-DWgt_R: Recodificación del peso de en el parto
* 14-FAGECOMB: Años combinados del padre
* 15-FEDUC: Educación del padre. (1)8th grado o menos, (2)De 9th a 12th grado sin diploma, (3)Graduado de la escuela secundaria o GED completado, (4)Algunos créditos universitarios, pero sin título, (5)Grado asociado (AA, AS), (6)Licenciatura (BA, AB, BS), (7)Maestría (MA, MS, MEng, MEd, MSW, MBA), (8)Doctorado (PhD, EdD) o Título Profesional (MD, DDS,DVM, LLB, JD), (9)Desconocido

* 16-FHISPX: Origen hispánico del padre. (0)No hispánico, (1)Mexicano, (2)Puerto Riqueño, (3)Cubano, (4)Centro americano o sudamericano, (5)Dominicano, (6)Otro, (9)Desconocido

* 17-FRACE15: ********
* 18-FRACE31: ********

* 19-FRACE6: Raza del padre. (1)Blanca, (2)Negra, (3)Indoamericana o nativa alaskeña, (4)Asiatica, (5) Hawaiiana o de otra isla del pacifico, (6)Más de una raza, (9)Desconocido.

* 20-ILLB_R: Intervalo desde la última recodificación de nacidos vivos (000-003) Plural delivery *** (004-300) Meses desde el último nacimiento.

* 21-ILOP_R: Registro del intervalo de nacimiento (000-003) Plural delivery, (004-300) Meses desde el último nacimiento, 888 No aplicable/Primer nacimiento, (999)Desconocido.

* 22-ILP_R: Intervalo desde el útimo registro de nacimiento, (000-003) Plural delivery, (004-300) Meses desde el último nacimiento, 888 No aplicable/Primer nacimiento, (999)Desconocido. 

* 23-IMP_SEX: Sexo imputado (Registro en blanco)Sin imputar, (1)Imputado.
* 24-IP_GON: Presencia de infección del tipo Gonorrhea, (Y)Si,  (N)No, (U)Desconocido
* 25-LD_INDL: Parto inducido (Y)Si,  (N)No, (U)Desconocido
* 26-**MAGER:** Años de la madre
* 27-MAGE_IMPFLG: Años de la madre imputados (Registro en blanco)Sin imputar, (1)Imputado.
* 28-MAR_IMP: Estado civil de la madre imputado (Registro en blanco)Sin imputar, (1)Imputado.
* 29-MBSTATE_REC: Procedencia nativa de la madre (1)Nacida en EEUU, (2)Nacida fuera de EEUU, (3)Desconocido

* 30-**MEDUC:** Educación de la madre, (1)8th grado o menos, (2)De 9th a 12th grado sin diploma, (3)Graduado de la escuela secundaria o GED completado, (4)Algunos créditos universitarios, pero sin título, (5)Grado asociado (AA, AS), (6)Licenciatura (BA, AB, BS), (7)Maestría (MA, MS, MEng, MEd, MSW, MBA), (8)Doctorado (PhD, EdD) o Título Profesional (MD, DDS,DVM, LLB, JD), (9)Desconocido

* 31-MHISPX: Origen hispánico del padre. (0)No hispánico, (1)Mexicano, (2)Puerto Riqueño, (3)Cubano, (4)Centro americano o sudamericano, (5)Dominicano, (6)Otro, (9)Desconocido  

* 32-MM_AICU: Ingreso en cuidados intensivos, (Y)Si,  (N)No, (U)Desconocido
* 33-MRACE15: *****
* 34-MRACE31: *****
* 35-MRACEIMP: Raza de la madre imputada (Registro en blanco)Sin imputar, (1)Raza desconocida imputada, (2)Raza Imputada  

* 36-**MRAVE6:** Raza de la madre. (1)Blanca, (2)Negra, (3)Indoamericana o nativa alaskeña, (4)Asiatica, (5) Hawaiiana o de otra isla del pacifico, (6)Más de una raza, (9)Desconocido.
* 37-MTRAN: Madre transferida, (Y)Si,  (N)No, (U)Desconocido
* 38-**M_Ht_In:** Altura de la madre en pulgadas totales
* 39-NO_INFEC: Sin infecciones reportadas, (Y)Si,  (N)No, (U)Desconocido
* 40-NO_MMORB: Sin morbilidad materna reportada, (Y)Si,  (N)No, (U)Desconocido
* 41-**NO_RISKS:** Sin factores de riesgo reportados, (Y)Si,  (N)No, (U)Desconocido
* 42-PAY: Origen del pago del parto, (1)Seguro público (Medicaid), (2)Seguro privado
* 43-PAY_REC: Registro del pago, (1)Medicaid, (2)Seguro privado, (3)Pago sin seguro, (4)Otro, (9)Desconocido

* 44-PRECARE: Mes en que comenzó la atención prenatal (00)Sin atención prenatal, (01-10)Mes en el que comenzó la atención prenatal, (99)Desconocido  

* 45-PREVIS: Número de visitas prenatales  

* 46-**PRIORDEAD**: Número de niños muertos de nacimientos de niños previos.
* 47-**PRIORLIVE**: Número de niños vivos de nacimientos de niños previos.
* 48-**PRIORTERM**: Otras terminaciones anteriores.
* 49-**PWgt_R:** Recodificación de peso antes del embarazo, peso en libras.
* 50-RDMETH_REC: Registro del método de parto, (1)Vaginal, (2)Vaginal después de una cesárea anterior, (3)Cesárea primaria, (4)Ceárea repetida, (5)Vaginal (desconocido si hubo cesárea anterior), (6)Sección C (desconocido si hubo sección c anterior), (9)Sin establecer.  

* 51-RESTATUS: Estatus residencial, (1)Residente, (2) EL estado de ocurrencia y la residencia es la misma pero el condado es diferente, (3) El estado de ocurrencia y la residencia es diferente pero ambos son uno de los 50 estados de EE. UU o del distrito de Columbia (4)Residente extranjero  

* 52-RF_CESAR: Cesárea previa, (Y)Si,  (N)No, (U)Desconocido
* 53-RF_CESARN: Numero de cesáreas previas
* 54-**SEX:** Sexo del recien nacido, (M)Masculino,  (F)Femenino
* 55-**WTGAIN:** Incremento de peso de la madre



```{r carga_archivo}
filename <-("US_births(2018).csv")
data <- read.csv(filename)
dim(data)
names(data)
```


```{r }
data2 <- data[,c(3,4,5,8,26,30,36,38,41,46,47,48,49,54,55)]
dim(data2)
names(data2)
```
```{r }
sapply(data2, function(x) class(x))
```
Filtramos por las madres que no tienen factores de riesgo en el embarazo

```{r }
data2 <- data2[data2$NO_RISKS == 1,-9]
```


```{r }
dim(data2)
names(data2)
```
Vamos a construir la variable factor referente al primer nacimiento, para ello en primer lugar tratamos los registros con missing values en alguna de las variables PRIOTERM, PRIORLIVE y PRIORDEAD.

```{r}
nrow(data2[data2$PRIORTERM  == 99 | data2$PRIORLIVE == 99 | data2$PRIORDEAD == 99 ,])/nrow(data2)*100
```

El porcentaje de registros perdidos es del 0.42% por lo que podemos eliminar los registros ya que no perdemos información relevante en nuestros datos.
```{r}
data2 <- data2[!(data2$PRIORTERM  == 99 | data2$PRIORLIVE == 99 | data2$PRIORDEAD == 99) ,]
```

```{r}
data2$PRIMER_NACIMIENTO = 0
data2$PRIMER_NACIMIENTO[data2$PRIORTERM  == 0 & data2$PRIORLIVE == 0 & data2$PRIORDEAD == 0 ] = 1
```

```{r}
data2 <- data2[,-(10:12)]
```


Cambiamos en nombre de las variables

```{r}
names(data2)
```
```{r}
names(data2) = c("IMC","N_CIGARRILLOS","PESO_NACER_GM","ESTADO_CIVIL","PESO_MADRE_LB","EDAD_MADRE","EDUC_MADRE","RAZA_MADRE","ALTURA_MADRE","PESO_MADRE","SEXO_HIJO","GANANCIA_PESO_MADRE","PRIMER_NACIMIENTO")
```





Contamos con 15 variables categóricas y 13 variables numéricas.

Tratamiento de variables categóricas.

```{r }
numvars <- c(1,2,3,6,11,15,19,22,24)
catvars <- c(4,5,7,8,9,10,12,13,14,16,17,18,20,21,23)

names(data2[,catvars])
```









